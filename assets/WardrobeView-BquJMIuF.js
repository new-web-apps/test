import{z as $,x as S,y as p,A as x,D as A,E,G as W,B,C as I,H,u as M,I as K,J as N,d as T,K as j,r as y,l as z,o as m,c as g,f as G,w as J,v as O,a as i,m as V,t as D,F as Q,n as X,L as Y,M as f,p as Z,q as ee,_ as ae}from"./index-DvF2mOlz.js";var l=[];for(var L=0;L<256;++L)l.push((L+256).toString(16).slice(1));function oe(e,a=0){return(l[e[a+0]]+l[e[a+1]]+l[e[a+2]]+l[e[a+3]]+"-"+l[e[a+4]]+l[e[a+5]]+"-"+l[e[a+6]]+l[e[a+7]]+"-"+l[e[a+8]]+l[e[a+9]]+"-"+l[e[a+10]]+l[e[a+11]]+l[e[a+12]]+l[e[a+13]]+l[e[a+14]]+l[e[a+15]]).toLowerCase()}var h,se=new Uint8Array(16);function te(){if(!h&&(h=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!h))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return h(se)}var ne=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const C={randomUUID:ne};function le(e,a,o){if(C.randomUUID&&!a&&!e)return C.randomUUID();e=e||{};var t=e.random||(e.rng||te)();return t[6]=t[6]&15|64,t[8]=t[8]&63|128,oe(t)}const re=async e=>{const a=le(),o=A(H,a);let t="";try{await E(o,e.photo),console.log("Uploaded a blob or file!"),t=await W(o),console.log("save photo to storage")}catch(n){console.log(n),console.log("error save photo to storage");return}try{await B(I(p,`userData/${e.email}/wardrobeData`,a),{id:a,description:e.description,url:t}),console.log("save photo to db")}catch{console.log("error save photo to db");return}},ce=async e=>{const a=$(S(p,`userData/${e}/wardrobeData`)),o=await x(a);let t=[];for(let n of o.docs){const r=n.data();let u=0,v=S(p,`userData/${e}/wardrobeData/${n.id}/likes`);const _=await x(v);for(let U of _.docs)u++;t.push({...r,likes:u})}return t},q=M(),ie=async(e,a)=>{var n;const o=(n=q.user)==null?void 0:n.email;if(console.log("setLike email",o),e===o)return;const t=S(p,"userData",e,"wardrobeData",a,"likes");try{const r=I(p,"userData",e,"wardrobeData",a,"likes",o);(await K(r)).exists()?(console.log("delete"),await N(r)):(console.log("add"),await B(I(t,o),{}))}catch(r){console.error("error setLike",r)}},de=async(e,a)=>{var n;const o=(n=q.user)==null?void 0:n.email;console.log("setLike email",o);const t=S(p,"userData",e,"wardrobeData",a,"likes");try{const r=await x(t);let u=0;return r.forEach(v=>{console.log(v.id," => ",v.data()),u++}),console.log("count",u),u}catch(r){console.error("error setLike",r)}},R=e=>(Z("data-v-77f9c0db"),e=e(),ee(),e),ue={class:"wardrobe"},ve=R(()=>i("h1",null,"wardrobe",-1)),me=R(()=>i("h3",null,"Form Add Photo",-1)),ge=["disabled"],ye={key:0},pe={class:"errorMessage"},_e=R(()=>i("h3",null,"Wardrobe",-1)),ke={key:0},we={key:1},be=["src"],De=["onClick"],fe=["onClick"],he=T({__name:"WardrobeView",setup(e){const a=M(),o=Y(),t=j(()=>{var c,d;return((c=a==null?void 0:a.user)==null?void 0:c.email)===((d=o==null?void 0:o.params)==null?void 0:d.email)}),n=y(null),r=y("");function u(c){c.target.files[0]&&(n.value=c.target.files[0])}const v=y(!1),_=y(""),U=y(0);function F(){n.value=null,r.value="",U.value++}async function P(){var c;if(console.log("addPhoto"),!!n.value){v.value=!0,_.value="";try{await re({photo:n.value,description:r.value,email:(c=a==null?void 0:a.user)==null?void 0:c.email}),F()}catch(d){console.log(d),_.value=d==null?void 0:d.message}v.value=!1}}const b=y(null);return z(async()=>{var c;b.value=await ce((c=o==null?void 0:o.params)==null?void 0:c.email),console.log("photos",b.value)}),(c,d)=>(m(),g("div",ue,[ve,t.value?(m(),g("form",{key:0,onSubmit:G(P,["prevent"]),class:"add-photo-form"},[me,(m(),g("input",{type:"file",onChange:u,key:U.value},null,32)),J(i("input",{"onUpdate:modelValue":d[0]||(d[0]=s=>r.value=s),placeholder:"description"},null,512),[[O,r.value]]),i("button",{disabled:!n.value||c.loaging},"Add photo",8,ge),v.value?(m(),g("div",ye,"Loading...")):V("",!0),i("div",pe,D(_.value),1)],32)):V("",!0),i("div",null,[_e,b.value?(m(),g("div",we,[(m(!0),g(Q,null,X(b.value,s=>(m(),g("div",{key:s,class:"photo"},[i("div",null,"# "+D(s==null?void 0:s.id),1),i("img",{src:s==null?void 0:s.url},null,8,be),i("div",null,D(s==null?void 0:s.description),1),i("div",null,"likes: "+D(s==null?void 0:s.likes),1),i("button",{onClick:()=>{var k,w;f(ie)((w=(k=f(o))==null?void 0:k.params)==null?void 0:w.email,s==null?void 0:s.id)}},"Set like",8,De),i("button",{onClick:()=>{var k,w;f(de)((w=(k=f(o))==null?void 0:k.params)==null?void 0:w.email,s==null?void 0:s.id)}},"countLike",8,fe)]))),128))])):(m(),g("div",ke))])]))}}),Ue=ae(he,[["__scopeId","data-v-77f9c0db"]]);export{Ue as default};
