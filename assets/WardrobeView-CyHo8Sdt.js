import{z as k,x as R,y as I,A as B,D as C,E,G as F,B as M,C as P,H as q,d as A,u as L,I as W,r as p,l as $,o as i,c as u,f as H,w as N,v as T,a as c,m as U,t as _,F as j,n as z,J as G,p as J,q as K,_ as O}from"./index-C1pp-KM-.js";var a=[];for(var b=0;b<256;++b)a.push((b+256).toString(16).slice(1));function Q(e,o=0){return(a[e[o+0]]+a[e[o+1]]+a[e[o+2]]+a[e[o+3]]+"-"+a[e[o+4]]+a[e[o+5]]+"-"+a[e[o+6]]+a[e[o+7]]+"-"+a[e[o+8]]+a[e[o+9]]+"-"+a[e[o+10]]+a[e[o+11]]+a[e[o+12]]+a[e[o+13]]+a[e[o+14]]+a[e[o+15]]).toLowerCase()}var m,X=new Uint8Array(16);function Y(){if(!m&&(m=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!m))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return m(X)}var Z=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const f={randomUUID:Z};function ee(e,o,n){if(f.randomUUID&&!o&&!e)return f.randomUUID();e=e||{};var t=e.random||(e.rng||Y)();return t[6]=t[6]&15|64,t[8]=t[8]&63|128,Q(t)}const oe=async e=>{const o=ee(),n=C(q,o);let t="";try{await E(n,e.photo),console.log("Uploaded a blob or file!"),t=await F(n),console.log("save photo to storage")}catch(r){console.log(r),console.log("error save photo to storage");return}try{await M(P(I,`userData/${e.email}/wardrobeData`,o),{id:o,description:e.description,url:t}),console.log("save photo to db")}catch{console.log("error save photo to db");return}},ae=async e=>{const o=k(R(I,`userData/${e}/wardrobeData`)),n=await B(o);let t=[];return n.forEach(r=>{const v=r.data();console.log(r.id," => ",v),t.push(v)}),t},w=e=>(J("data-v-c1888efa"),e=e(),K(),e),te={class:"wardrobe"},se=w(()=>c("h1",null,"wardrobe",-1)),ne=w(()=>c("h3",null,"Form Add Photo",-1)),le=["disabled"],re={key:0},de={class:"errorMessage"},ce=w(()=>c("h3",null,"Wardrobe",-1)),ie={key:0},ue={key:1},ve=["src"],pe=A({__name:"WardrobeView",setup(e){const o=L(),n=G(),t=W(()=>{var s,d;return((s=o==null?void 0:o.user)==null?void 0:s.email)===((d=n==null?void 0:n.params)==null?void 0:d.email)}),r=p(null),v=p("");function S(s){s.target.files[0]&&(r.value=s.target.files[0])}const y=p(!1),h=p(""),D=p(0);function x(){r.value=null,v.value="",D.value++}async function V(){var s;if(console.log("addPhoto"),!!r.value){y.value=!0,h.value="";try{await oe({photo:r.value,description:v.value,email:(s=o==null?void 0:o.user)==null?void 0:s.email}),x()}catch(d){console.log(d),h.value=d==null?void 0:d.message}y.value=!1}}const g=p(null);return $(async()=>{var s;g.value=await ae((s=n==null?void 0:n.params)==null?void 0:s.email),console.log("photos",g.value)}),(s,d)=>(i(),u("div",te,[se,t.value?(i(),u("form",{key:0,onSubmit:H(V,["prevent"]),class:"add-photo-form"},[ne,(i(),u("input",{type:"file",onChange:S,key:D.value},null,32)),N(c("input",{"onUpdate:modelValue":d[0]||(d[0]=l=>v.value=l),placeholder:"description"},null,512),[[T,v.value]]),c("button",{disabled:!r.value||s.loaging},"Add photo",8,le),y.value?(i(),u("div",re,"Loading...")):U("",!0),c("div",de,_(h.value),1)],32)):U("",!0),c("div",null,[ce,g.value?(i(),u("div",ue,[(i(!0),u(j,null,z(g.value,l=>(i(),u("div",{key:l,class:"photo"},[c("div",null,"# "+_(l==null?void 0:l.id),1),c("img",{src:l==null?void 0:l.url},null,8,ve),c("div",null,_(l==null?void 0:l.description),1)]))),128))])):(i(),u("div",ie))])]))}}),me=O(pe,[["__scopeId","data-v-c1888efa"]]);export{me as default};
